import { eraseTaskD } from './dom.js';
import { deleteTask, projects } from './todo.js';


let working_task, working_project;


// "Control" function
const setupTaskD = (task, project) => {
    working_task = task; // object
    working_project = project; // name
    
    uI();
    setupDeleteButton();
};

const uI = () => {
    const taskNode = document.querySelector(`.${working_task.id}`);

    const title = document.createElement("div");
    title.textContent = working_task.title;
    taskNode.appendChild(title);

    const desc = document.createElement("div");
    desc.textContent = working_task.description;
    taskNode.appendChild(desc);

    const dueDate = document.createElement("div");
    dueDate.textContent = "Due date: "  + working_task.dueDate;
    taskNode.appendChild(dueDate);

    const priority = document.createElement("div");
    priority.textContent = "Priority: " + working_task.priority;
    taskNode.appendChild(priority);
};


const setupDeleteButton = () => {
    const btn = document.createElement('button');
    btn.textContent = "Remove";

    const taskNode = document.querySelector(`.${working_task.id}`);
    taskNode.appendChild(btn);

    // find a way to move
    // we need to obtain task object from the button itself
    // this is done via matching btn class name which is equal to the id
    // of the task that we are seeking in a projects object
    btn.addEventListener('click', () => {
        const taskID = btn.parentNode.className;
        const currentProject = document.querySelector(".selected").textContent;

        let title;
        for (let em in projects[currentProject].tasks) {
            if (projects[currentProject].tasks[em].id == taskID) {
                title = projects[currentProject].tasks[em].title;
            }
        }
        deleteTask(currentProject, projects[currentProject].tasks[title]);
        eraseTaskD(taskID);
    });
};

export { setupTaskD };